If your loadbalancer (e.g. F5 BigIp) offloads SSL you mostly need to know the original transport, e.g. so that redirects also go to https urls - otherwise redirects would result in a loop. The F5 can set a custom http header (e.g. "Original-Transport" with value "SSL") so that this can be evaluated and handled appropriately.

The solution in this case: A servlet filter checks if there's the http header "Original-Transport", and if it has the value "SSL" an HttpServletRequestWrapper is created which says that this request uses https, and also an HttpServletResponseWrapper is installed which makes correct redirects.

If you want to use this just add a filter element to your web.xml:

    <filter>
        <filter-name>OriginalTransportFilter</filter-name>
        <filter-class>de.javakaffee.web.originaltransport.OriginalTransportCheckingFilter</filter-class>
    </filter>
    
    <filter-mapping>
        <filter-name>OriginalTransportFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

Of course you need the jar file in your classpath (for building see http://buildr.apache.org).


